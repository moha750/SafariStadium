# دليل تطبيق الترحيل (Migration) لنظام إدارة الوقت

## الخطوات المطلوبة لتطبيق الترحيل على قاعدة بيانات Supabase

### 1. الدخول إلى لوحة تحكم Supabase

1. افتح متصفح الويب وانتقل إلى: https://supabase.com
2. سجل الدخول إلى حسابك
3. اختر مشروعك: `dekpvervphhafucivgtu`

### 2. تطبيق الترحيل (Migration)

#### الطريقة الأولى: عبر SQL Editor في لوحة التحكم

1. من القائمة الجانبية، اختر **SQL Editor**
2. انقر على **New Query**
3. انسخ محتوى الملف التالي بالكامل:
   ```
   supabase/migrations/002_create_time_slots_table.sql
   ```
4. الصق المحتوى في محرر SQL
5. انقر على **Run** أو اضغط `Ctrl+Enter` لتنفيذ الاستعلام
6. تأكد من ظهور رسالة نجاح العملية

#### الطريقة الثانية: عبر Supabase CLI (إذا كان مثبتاً)

```bash
# من مجلد المشروع
supabase db push
```

### 3. التحقق من نجاح الترحيل

بعد تطبيق الترحيل، تحقق من إنشاء الجدول والدوال:

1. في لوحة تحكم Supabase، اذهب إلى **Table Editor**
2. يجب أن ترى جدول جديد باسم `time_slots` يحتوي على الأعمدة التالية:
   - `id` (UUID)
   - `field_name` (VARCHAR)
   - `slot_date` (DATE)
   - `start_time` (TIME)
   - `end_time` (TIME)
   - `is_available` (BOOLEAN)
   - `created_at` (TIMESTAMP)
   - `updated_at` (TIMESTAMP)

3. للتحقق من الدوال، اذهب إلى **Database** > **Functions**
   يجب أن ترى:
   - `generate_time_slots`
   - `delete_time_slots`

### 4. اختبار النظام

بعد تطبيق الترحيل:

1. افتح ملف `admin.html` في المتصفح
2. سجل الدخول إلى لوحة التحكم
3. انقر على تبويب **إدارة الوقت**
4. جرب إنشاء فترات زمنية تلقائياً:
   - اختر ملعب
   - حدد تاريخ البداية والنهاية
   - انقر على "إنشاء الفترات تلقائياً"
5. تحقق من عرض الفترات المنشأة

## الفترات الزمنية الثابتة

النظام يقوم تلقائياً بإنشاء 9 فترات زمنية ثابتة لكل يوم:

1. **3:30 م - 5:00 م** (15:30 - 17:00)
2. **5:00 م - 6:30 م** (17:00 - 18:30)
3. **6:30 م - 8:00 م** (18:30 - 20:00)
4. **8:00 م - 9:30 م** (20:00 - 21:30)
5. **9:30 م - 11:00 م** (21:30 - 23:00)
6. **11:00 م - 12:30 ص** (23:00 - 00:30)
7. **12:30 ص - 2:00 ص** (00:30 - 02:00)
8. **2:00 ص - 3:30 ص** (02:00 - 03:30)
9. **3:30 ص - 5:00 ص** (03:30 - 05:00)

## ميزات نظام إدارة الوقت

### الإنشاء التلقائي
- إنشاء فترات زمنية لملعب معين خلال فترة زمنية محددة
- حذف فترات زمنية بشكل جماعي

### الإنشاء اليدوي
- إنشاء فترة زمنية واحدة بشكل يدوي
- تحديد الملعب والتاريخ والوقت بدقة

### عرض وإدارة الفترات
- عرض جميع الفترات الزمنية مع إمكانية التصفية
- تفعيل/تعطيل الفترات الزمنية
- حذف فترات زمنية محددة
- عرض الفترات مجمعة حسب التاريخ

## استكشاف الأخطاء

### خطأ: "فشل في إنشاء الفترات الزمنية"
- تأكد من تطبيق الترحيل بشكل صحيح
- تحقق من صلاحيات قاعدة البيانات (RLS Policies)

### خطأ: "هذه الفترة موجودة بالفعل"
- الفترة الزمنية موجودة مسبقاً في قاعدة البيانات
- استخدم خيار "عرض الفترات" للتحقق من الفترات الموجودة

### لا تظهر الفترات الزمنية
- تأكد من تحديد نطاق التواريخ الصحيح
- تحقق من اختيار الملعب المناسب في الفلتر

## ملاحظات مهمة

1. **النسخ الاحتياطي**: يُنصح بأخذ نسخة احتياطية من قاعدة البيانات قبل تطبيق أي ترحيل
2. **الصلاحيات**: تأكد من تفعيل Row Level Security (RLS) للأمان
3. **الأداء**: الجدول مُحسّن بفهارس (Indexes) لتحسين الأداء
4. **التكرار**: النظام يمنع إنشاء فترات مكررة تلقائياً

## الدعم الفني

إذا واجهت أي مشاكل:
- راجع ملف `API_DOCUMENTATION.md` للمزيد من التفاصيل
- تحقق من console المتصفح للأخطاء
- راجع logs قاعدة البيانات في Supabase

---

**تم التطوير بواسطة:** محمد المطر  
**التواصل:** https://wa.me/966551710634
